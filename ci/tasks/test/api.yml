---
platform: linux

inputs:
  - name: repo

caches:
- path: repo/node_modules

image_resource:
  type: docker-image
  source:
    repository: mhart/alpine-node

run:
  path: sh
  args:
    - -exc
    - |
      mkdir -p .tmp
      wget https://raw.githubusercontent.com/OpenUserCSS/openusercss.org/master/ci/scripts/bootstrap.sh -O .tmp/bootstrap.sh
      source .tmp/bootstrap.sh
      prepare
      npm run build-api:fast
      npm run test:api

params:
  NODE_ENV: production
